<!doctype html>
<html lang="en" class="h-100">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
      <meta name="author" content="Victor Yon">

      <!-- Disable indexing -->
      <meta name="robots" content="noindex,nofollow">
      <meta name="googlebot" content="noindex,nofollow">

      <title>Productificator</title>

    <style>
        #clock {
            font-family: TimeTraveler, Arial, Helvetica, sans-serif;
            font-size: 95px;
            font-weight: 400;
      }
    </style>

      <script type="text/javascript">
          function updateTime() {
              var date = new Date();
              var hours = date.getHours();
              var min = date.getMinutes();
              var seconds = date.getSeconds();
              var mill = date.getMilliseconds();

              // Add fancy 0
              hours = (hours < 10 ? "0" + hours : hours);
              min = (min < 10 ? "0" + min : min);


              var timeStr = hours + ":" + min;
              document.getElementById("clock").innerText = timeStr;

              //console.log("Refresh time at: " + hours + ":" + min + ":" + seconds)
              return 60000 - (seconds * 1000 + mill);
          }

          function fetchTodos() {
            var xhr = new XMLHttpRequest();
            // xhr.open('GET', 'http://localhost:5000/notion/today_tasks', true);
            xhr.open('GET', '/productificator_api/notion/today_tasks', true);
            xhr.onreadystatechange = function () {
              if (xhr.readyState === 4 && xhr.status === 200) {
                var data = JSON.parse(xhr.responseText);
                var todosHTML = '';
                var doneHTML = '';
                for (var i = 0; i < data.length; i++) {
                  if (data[i].is_done) {
                    doneHTML += '<li>' + data[i].label + '</li>';
                  } else {
                    todosHTML += '<li>' + data[i].label + '</li>';
                  }
                }
                document.getElementById('todos').innerHTML = todosHTML;
                document.getElementById('done').innerHTML = doneHTML;
              }
            };
            xhr.send();
          }

          function initAll() {
              nextUpdate = updateTime();
            fetchTodos();
              // Repeat update every minute, starting from the next minute
              setTimeout(function () {
                updateTime();
                fetchTodos();
                  setInterval(updateTime, 60000);
              }, nextUpdate);
          }

          window.onload = initAll;
      </script>

  </head>
  <body>
  <div id="clock"></div>
  <div id="tasks">
    <h2>To-do List</h2>
    <ul id="todos">
      <!-- To-do tasks will be populated here -->
    </ul>
    <ul id="done">
      <!-- Completed tasks be populated here -->
    </ul>
  </div>
  </body>
</html>

